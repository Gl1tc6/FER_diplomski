Zadatci se rade u ESP IDF-u i simulira u Wokwiu (https://wokwi.com/esp32). Ne
predajete cijeli projekt nego predajete zip arhivu koja sadrÅ¾i sve c/cpp i h datoteke koje
ste kreirali te prevedenu binarnu (izvrÅ¡nu) datoteku (.bin).

Zadatak (8 bodova)
Na raÄunalni sustav zasnovan sa ESP32 dodana su tri I2C vanjske jedinica (I2C_1,
I2C_2, I2C_3 kako je prikazano na slici 1.

Vanjska jedinica I2C_1 (adresa 0x20) izvrÅ¡ava operacije zbrajanja i oduzimanja.
Vanjska jedinica I2C_2 (adresa 0x22) izvrÅ¡ava operacije mnoÅ¾enja i dijeljenja.
Vanjska jedinica I2C_3 (adresa 0x24) izvrÅ¡ava operacije kvadriranja i raÄunanja drugog
korijena

SKLOP I2C_1
I2C_1 sklop je â€slaveâ€œ I2C ureÄ‘aj koji se nalazi na adresi 0x20 i obavlja operaciju
zbrajanja i oduzimanja s brojevima u formatu ï¬‚oat.
Interno sklop ima tri registra u koje je moguÄ‡e pisati. ÄŒitanje iz registara nje moguÄ‡e.
ÄŒitanjem sa ALU sklopa dobiva se rezultat operacije. Pogledati (ÄŒITANJE SA I2C
SKLOPA).
Upis u registre se mora obavljati jedan po jedan. Nije moguÄ‡e odjednom upisati
podatke u viÅ¡e registara.
REGISTAR OPERACIJE (0x00)
Registar operacija je veliÄine jednog bajta koji odreÄ‘uje koja operacija Ä‡e se raditi. Popis
operacija je sljedeÄ‡i:
Operacija
OPERATION_NOP
OPERATION_ADD
OPERATION_SUB
OPERATION_READ_P1
OPERATION_READ_P2

Vrijednost
0x00
0x01
0x02
0x64
0x65

Opis operacije
ne radi niÅ¡ta ali kod Äitanja vraÄ‡a -0.101010
Zbraja vrijednost PAR1 i PAR2
Oduzima vrijednost PAR1 i PAR2
Ne raÄuna niÅ¡ta, samo vraÄa PAR1
Ne raÄuna niÅ¡ta, samo vraÄa PAR2

REGISTAR PAR1 (0x01)
Pisanjem u ovaj registar postavlja se vrijednost prvog parametra (PAR1). Registar je tipa float i za
upisivanje je potrebno poslati 4 bajta koja predstavljaju float broj. Prvo se Å¡alje niÅ¾i bajt i onda
prema viÅ¡im bajtovima.
REGISTAR PAR2 (0x02)
Pisanjem u ovaj registar postavlja se vrijednost drugog parametra (PAR2). Registar je tipa float i
za upisivanje je potrebno poslati 4 bajta koja predstavljaju float broj. Prvo se Å¡alje niÅ¾i bajt i onda
prema viÅ¡im bajtovima.

SKLOP I2C_2
I2C_2 sklop je â€slaveâ€œ I2C ureÄ‘aj koji se nalazi na adresi 0x22 i obavlja operacije
mnoÅ¾enja i dijeljenja s brojevima u formatu ï¬‚oat.
Interno sklop ima tri registra u koje je moguÄ‡e pisati. ÄŒitanje iz registara nje moguÄ‡e.
ÄŒitanjem sa ALU sklopa dobiva se rezultat operacije. Pogledati (ÄŒITANJE SA I2C
SKLOPA).
Upis u registre se mora obavljati jedan po jedan. Nije moguÄ‡e odjednom upisati
podatke u viÅ¡e registara.
REGISTAR OPERACIJE (0x00)
Registar operacija je veliÄine jednog bajta koji odreÄ‘uje koja operacija Ä‡e se raditi. Popis
operacija je sljedeÄ‡i:
Operacija
OPERATION_NOP
OPERATION_MUL
OPERATION_DIV
OPERATION_READ_A
OPERATION_READ_B

Vrijednost
0x00
0x01
0x02
0x64
0x65

Opis operacije
ne radi niÅ¡ta ali kod Äitanja vraÄ‡a -0.101010
Zbraja vrijednost PAR1 i PAR2
Oduzima vrijednost PAR1 i PAR2
Ne raÄuna niÅ¡ta, samo vraÄa PAR1
Ne raÄuna niÅ¡ta, samo vraÄa PAR2

REGISTAR PAR1 (0x01)
Pisanjem u ovaj registar postavlja se vrijednost prvog parametra (PAR1). Registar je tipa float i za
upisivanje je potrebno poslati 4 bajta koja predstavljaju float broj. Prvo se Å¡alje niÅ¾i bajt i onda
prema viÅ¡im bajtovima.
REGISTAR PAR2 (0x02)
Pisanjem u ovaj registar postavlja se vrijednost drugog parametra (PAR2). Registar je tipa float i
za upisivanje je potrebno poslati 4 bajta koja predstavljaju float broj. Prvo se Å¡alje niÅ¾i bajt i onda
prema viÅ¡im bajtovima.

SKLOP I2C_3
I2C_3 sklop je â€slaveâ€œ I2C ureÄ‘aj koji se nalazi na adresi 0x24 i obavlja operacije
kvadriranja i raÄunanja drugog korijena s brojevima u formatu ï¬‚oat.
Interno sklop ima dva registra u koje je moguÄ‡e pisati. ÄŒitanje iz registara nje moguÄ‡e.
ÄŒitanjem sa ALU sklopa dobiva se rezultat operacije. Pogledati (ÄŒITANJE SA I2C
SKLOPA).
Upis u registre se mora obavljati jedan po jedan. Nije moguÄ‡e odjednom upisati
podatke u viÅ¡e registara.
REGISTAR OPERACIJE (0x00)
Registar operacija je veliÄine jednog bajta koji odreÄ‘uje koja operacija Ä‡e se raditi. Popis
operacija je sljedeÄ‡i:
Operacija
OPERATION_NOP
OPERATION_POWER
OPERATION_MUL
OPERATION_READ_A

Vrijednost
0x00
0x01
0x02
0x64

Opis operacije
ne radi niÅ¡ta ali kod Äitanja vraÄ‡a -0.101010
Zbraja vrijednost PAR1 i PAR2
Oduzima vrijednost PAR1 i PAR2
Ne raÄuna niÅ¡ta, samo vraÄa PAR1

REGISTAR PAR1 (0x01)
Pisanjem u ovaj registar postavlja se vrijednost prvog parametra (PAR1). Registar je tipa float i za
upisivanje je potrebno poslati 4 bajta koja predstavljaju float broj. Prvo se Å¡alje niÅ¾i bajt i onda
prema viÅ¡im bajtovima.
ÄŒITANJE SA I2C SKLOPA (odnosi se na I2C_1, I2C_2 i I2C_3)
Prilikom Äitanja obavlja se operacija koja je zadana u internom registru operacija i potrebno je
proÄitati 4 uzastopna bajta. ProÄitana 4 bajta predstavljaju rezultat u float formatu. Prvo se Äita
niÅ¾i bajt i tako redom do najviÅ¡eg.
KORIÅ TENJE FLOAT BROJEVA
Za pretvorbu float broja u bajt polje najjednostavnije je koristiti union strukturu:
union floatunion_t {
float f;
unsigned char a[sizeof (float)];
};
Iz ove union strukture jednostavno moÅ¾ete Äitati i pisati float broj i bajt polje.

Potrebno je napisati program koji raÄuna:
ğ‘“(ğ‘, ğ‘, ğ‘) =

ğ‘ + âˆšğ‘ âˆ’ ğ‘ğ‘
ğ‘

koristeÄ‡i vanjske jedinica I2C_1, I2C_2 i I2C_3 bez da koristite funkcija c/c++ biblioteka.
Vrijednosti a, b i c su realni brojevi.
Rad programa provjeriti raÄunanjem f(10, 11.5, 12.7) a rezultat usporediti sa programski
izraÄunatim rezultatom koristeÄ‡i c/c++ biblioteke.

Slika 1.
Potrebne datoteke za izvrÅ¡avanje programa:
-

diagram.json
i2c-1.chip.c
i2c-1.chip.json
i2c-2.chip.c
i2c-2.chip.json
i2c-3.chip.c
i2c-3.chip.json

Navedene datoteke treba dodati u Wokwi simulator koristeÄ‡i opciju Upload
ï¬le(s):

Prije uÄitavanja diagram.json datoteke potrebno je maknuti staru tako da je
odaberete i stisnete Delete opciju u izborniku.

